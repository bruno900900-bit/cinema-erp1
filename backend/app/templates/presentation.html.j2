<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>{{ cover.title if cover and cover.title else 'Apresentação' }}</title>
  <style>
    @page { margin: 28mm 18mm 25mm 18mm; }
    body { font-family: Arial, sans-serif; margin:0; padding:0; color:#222; background:#fff; }
    h1,h2,h3 { margin:0 0 12px; font-weight:600; }
    .page-break { page-break-after: always; }
    .cover { text-align:left; padding-top:120px; }
    .cover-title { font-size:44px; letter-spacing:0.5px; }
    .cover-sub { font-size:22px; color:#555; margin-top:10px; }
    .meta-date { margin-top:60px; font-size:14px; color:#666; }
    .toc-title { font-size:34px; margin-bottom:24px; }
    .toc-item { display:flex; align-items:baseline; font-size:14px; margin-bottom:6px; }
    .toc-item .dots { flex:1; border-bottom:1px dotted #bbb; margin:0 8px; height:6px; }
    .grid { display:grid; gap:14px; }
    .layout-single { display:flex; flex-direction:column; }
    .layout-two { display:grid; grid-template-rows:1fr 1fr; gap:14px; }
    .layout-grid4 { display:grid; grid-template-columns:1fr 1fr; grid-auto-rows:1fr; gap:14px; }
    figure { margin:0; }
    figure img { width:100%; height:auto; border-radius:6px; object-fit:cover; }
    figure figcaption { font-size:11px; color:#444; margin-top:4px; }
    .notes { margin-top:14px; padding:10px 12px; background:#f5f5f7; border-left:4px solid #888; font-size:12px; line-height:1.4; }
    header { position:fixed; top:-18mm; left:0; right:0; height:10mm; font-size:10px; color:#666; display:flex; justify-content:space-between; }
    footer { position:fixed; bottom:-15mm; left:0; right:0; height:12mm; font-size:10px; display:flex; justify-content:space-between; color:#666; }
    .page-counter:after { content: counter(page) " / " counter(pages); }
    .content-page h2 { font-size:18px; margin:0 0 18px; }
    /* Dark theme overrides */
    {% if theme == 'dark' %}
    body { background:#111; color:#eee; }
    .cover-sub { color:#aaa; }
    .notes { background:#1e1e1e; border-left-color:#555; color:#ccc; }
    header, footer { color:#999; }
    figure figcaption { color:#bbb; }
    .toc-item .dots { border-bottom-color:#555; }
    {% endif %}
  </style>
</head>
<body class="theme-{{ theme or 'default' }}">
<header>
  <div>{{ meta.executive_summary and 'Apresentação Enriquecida' or 'Apresentação' }}</div>
  <div>{{ cover.title if cover and cover.title else '' }}</div>
</header>
<footer>
  <div>{{ meta.createdAt or meta.created_at or '' }}</div>
  <div class="page-counter"></div>
</footer>

{% if cover and cover.enabled %}
<section class="cover page-break">
  <h1 class="cover-title">{{ cover.title }}</h1>
  {% if cover.subtitle %}<div class="cover-sub">{{ cover.subtitle }}</div>{% endif %}
  {% if meta.executive_summary %}
  <div class="notes" style="margin-top:40px; font-size:14px;">{{ meta.executive_summary }}</div>
  {% endif %}
  {% if cover.imageId and photos[cover.imageId|string] %}
    <div style="margin-top:50px;">
      <img style="width:100%; max-height:420px; object-fit:cover; border-radius:10px;" src="{{ photos[cover.imageId|string].url }}" />
    </div>
  {% endif %}
  <div class="meta-date">Gerado em: {{ meta.createdAt or meta.created_at }}</div>
</section>
{% endif %}

{% if summary and summary.enabled %}
<section class="page-break">
  <h1 class="toc-title">Sumário</h1>
  {% for p in pages %}
    <div class="toc-item">
      <a href="#pg-{{ p.id }}" style="text-decoration:none; color:inherit; flex:0 1 auto;">
        {{ p.title or ('Página ' ~ loop.index) }}
      </a>
      <span class="dots"></span>
      <span>{{ loop.index }}</span>
    </div>
  {% endfor %}
</section>
{% endif %}

{% for p in pages %}
<section class="content-page page-break" id="pg-{{ p.id }}">
  {% if p.title %}<h2>{{ p.title }}</h2>{% endif %}
  {% set layout = p.layout %}
  {% if layout == 'single' %}
    <div class="layout-single">
      {% for pid in p.photoIds %}
        {% if loop.index == 2 %}{% break %}{% endif %}
        {% set ph = photos[pid|string] %}
        {% if ph %}
        <figure>
          <img src="{{ ph.url }}" />
          {% if ph.caption %}<figcaption>{{ ph.caption }}</figcaption>{% endif %}
        </figure>
        {% endif %}
      {% endfor %}
    </div>
  {% elif layout == 'two' %}
    <div class="layout-two">
      {% for pid in p.photoIds %}
        {% if loop.index <= 2 %}
        {% set ph = photos[pid|string] %}
        {% if ph %}
        <figure>
          <img src="{{ ph.url }}" />
          {% if ph.caption %}<figcaption>{{ ph.caption }}</figcaption>{% endif %}
        </figure>
        {% endif %}
        {% endif %}
      {% endfor %}
    </div>
  {% elif layout == 'grid4' %}
    <div class="layout-grid4">
      {% for pid in p.photoIds %}
        {% if loop.index <= 4 %}
        {% set ph = photos[pid|string] %}
        {% if ph %}
        <figure>
          <img src="{{ ph.url }}" />
          {% if ph.caption %}<figcaption>{{ ph.caption }}</figcaption>{% endif %}
        </figure>
        {% endif %}
        {% endif %}
      {% endfor %}
    </div>
  {% endif %}
  {% if p.notes %}<div class="notes">{{ p.notes }}</div>{% endif %}
</section>
{% endfor %}
</body>
</html>
